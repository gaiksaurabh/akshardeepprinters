<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cost Estimation Tool</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.8.2/jspdf.plugin.autotable.min.js"></script>
    <style>
        html, body {
            height: 100%; margin: 0; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; background-color: #f0f4f8;
        }
        body {
            display: flex; flex-direction: column; padding: 1.5rem; box-sizing: border-box; align-items: center;
        }
        .container {
            width: 100%; max-width: 1300px; flex-grow: 1; display: flex; flex-direction: column;
        }
        h1 {
            text-align: center; color: #1a253c; margin-bottom: 1.5rem; flex-shrink: 0;
        }
        .sections-wrapper {
            display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; flex-grow: 1;
        }
        .section {
            background-color: #ffffff; padding: 1.5rem; border-radius: 12px; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.07); display: flex; flex-direction: column;
        }
        .section-title {
            font-size: 1.3rem; color: #0066cc; margin-top: 0; margin-bottom: 1.5rem; border-bottom: 2px solid #e9ecef; padding-bottom: 0.5rem;
        }
        .form-grid {
            display: grid; grid-template-columns: 1fr 1fr; gap: 1rem 1.5rem;
        }
        .form-grid-single-col {
             grid-template-columns: 1fr;
        }
        .grid-col-span-2 { grid-column: span 2; }
        .form-group { display: flex; flex-direction: column; justify-content: flex-end; }
        .form-group label, .label-with-checkbox {
            margin-bottom: 0.5rem; font-weight: 500; color: #495057; font-size: 0.9rem;
        }
        .form-group select,
        .form-group input {
            width: 100%; padding: 0.65rem; border: 1px solid #ced4da; border-radius: 8px; font-size: 0.95rem; box-sizing: border-box; background-color: #f8f9fa;
        }
        .input-group-inline {
            display: flex; align-items: flex-end; gap: 0.5rem;
        }
        .input-group-inline .form-group { flex-grow: 1; }
        .inline-checkbox {
             display: flex; align-items: center; gap: 0.5rem;
        }
        .inline-checkbox input { width: auto; }
        .inline-checkbox label { margin: 0; font-weight: normal; }
        .label-with-checkbox {
            display: flex; justify-content: space-between; align-items: center;
        }
        .total-cost-section {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background-color: #1a253c;
            color: white;
            padding: 1rem 1.5rem;
            border-radius: 12px;
            margin-top: 1.5rem;
            flex-shrink: 0;
        }
        .total-display { text-align: right; }
        .total-display .total-label { font-size: 1rem; margin: 0 0 0.25rem 0; opacity: 0.9; }
        .total-display .total-value { font-size: 2.2rem; font-weight: bold; margin: 0; }
        #download-pdf-btn {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 0.8rem 1.5rem;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        #download-pdf-btn:hover { background-color: #0056b3; }

        @media (max-width: 1200px) { .sections-wrapper { grid-template-columns: 1fr; } }
    </style>
</head>
<body>

    <div class="container">
        <h1>Cost Estimation</h1>
        <div class="sections-wrapper">
            <div class="section">
                <h2 class="section-title">1. Printing</h2>
                <div class="form-grid">
                    <div class="form-group"><label for="job-size">Job Size</label><select id="job-size"><option value="">Select Size</option><option value="12X18">12X18</option><option value="18X23">18X23</option><option value="15X20">15X20</option><option value="10X15">10X15</option><option value="20X28">20X28</option><option value="18X25">18X25</option><option value="19X25">19X25</option></select></div>
                    <div class="form-group"><label for="printing-gsm-select">GSM</label><select id="printing-gsm-select"></select></div>
                    <div class="form-group grid-col-span-2">
                        <label for="quantity">Quantity</label>
                        <div class="input-group-inline">
                            <div class="form-group" style="margin:0;"><input type="number" id="quantity" placeholder="e.g., 2000"></div>
                            <div class="inline-checkbox" style="height: 100%; padding-bottom: 0.2rem;"><input type="checkbox" id="fb-check"><label for="fb-check">F/B</label></div>
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="label-with-checkbox">
                           <label for="printing-cost" style="margin:0;">Printing Cost (₹)</label>
                           <div class="inline-checkbox"><input type="checkbox" id="without-plate-check"><label for="without-plate-check">Without Plate</label></div>
                        </div>
                        <input type="number" class="cost-input" id="printing-cost" placeholder="0.00" data-label="Printing Cost">
                    </div>
                    <div class="form-group"><label for="second-cost">Second (₹)</label><input type="number" class="cost-input" id="second-cost" placeholder="0.00" data-label="Second Printing"></div>
                </div>
            </div>

            <div class="section">
                <h2 class="section-title">2. Paper</h2>
                <div class="form-grid">
                    <div class="form-group"><label for="paper-size-select">Paper Size</label><select id="paper-size-select"></select></div>
                    <div class="form-group"><label for="paper-gsm-select">Paper GSM</label><select id="paper-gsm-select"></select></div>
                    <div class="form-group"><label for="paper-sheets-input">No. of Sheets</label><input type="number" id="paper-sheets-input" placeholder="0"></div>
                    <div class="form-group"><label for="paper-rate-input">Rate per kg (₹)</label><input type="number" id="paper-rate-input" placeholder="e.g., 85"></div>
                    <div class="form-group grid-col-span-2">
                        <div class="label-with-checkbox">
                            <label for="paper-cost" style="margin:0;">Paper Cost (₹)</label>
                            <div class="inline-checkbox"><input type="checkbox" id="gst-checkbox"><label for="gst-checkbox">Without GST</label></div>
                        </div>
                        <input type="number" class="cost-input" id="paper-cost" placeholder="0.00" data-label="Paper Cost">
                    </div>
                </div>
            </div>

            <div class="section">
                <h2 class="section-title">3. Lamination</h2>
                <div class="form-grid form-grid-single-col">
                    <div class="form-grid" style="grid-template-columns: 1fr 1fr;">
                        <div class="form-group"><label for="lamination-type">Lamination</label><select id="lamination-type"><option value="">None</option><option value="gloss">Gloss</option><option value="matte">Matte</option><option value="thermal_gloss">Thermal Gloss</option><option value="thermal_matte">Thermal Matte</option></select></div>
                        <div class="form-group"><label for="lami-size">Lamination Size</label><select id="lami-size"><option value="">Select Size</option><option value="12x18">12x18</option><option value="11x17">11x17</option><option value="18x23">18x23</option><option value="15x20">15x20</option><option value="10x15">10x15</option><option value="A4">A4</option></select></div>
                    </div>
                    <div class="form-group"><label for="lami-cost">Lamination Cost (₹)</label><input type="number" class="cost-input" id="lami-cost" placeholder="0.00" data-label="Lamination Cost"></div>
                    <div class="form-grid" style="grid-template-columns: 1fr 1fr;">
                        <div class="form-group"><label for="punching-cost">Punching (₹)</label><input type="number" class="cost-input" id="punching-cost" placeholder="0.00" data-label="Punching"></div>
                        <div class="form-group"><label for="clips-cost">Clips (₹)</label><input type="number" class="cost-input" id="clips-cost" placeholder="0.00" data-label="Clips"></div>
                    </div>
                </div>
            </div>
            
            <div class="section">
                <h2 class="section-title">4. Other Costs</h2>
                <div class="form-grid">
                    <div class="form-group"><label for="binding-cost">Binding Cost (₹)</label><input type="number" class="cost-input" id="binding-cost" placeholder="0.00" data-label="Binding Cost"></div>
                    <div class="form-group"><label for="other-misc-cost">Other Costs (₹)</label><input type="number" class="cost-input" id="other-misc-cost" placeholder="0.00" data-label="Other Costs"></div>
                    <div class="form-group"><label for="envelope-size">Envelope Size</label><select id="envelope-size"><option value="">None</option><option value="9x4">9x4</option><option value="9x5">9x5</option><option value="6x11">6x11</option></select></div>
                    <div class="form-group"><label for="env-cost">Envelope Cost (₹)</label><input type="number" class="cost-input" id="env-cost" placeholder="0.00" data-label="Envelope Cost"></div>
                </div>
            </div>
        </div>

        <div class="total-cost-section">
            <button id="download-pdf-btn">Download PDF</button>
            <div class="total-display">
                <h3 class="total-label">Grand Total</h3>
                <p class="total-value" id="total-cost">₹ 0.00</p>
            </div>
        </div>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        // --- DATA ---
        const paperData = [
            { size: "18x23", gsm: "STICKER", perSheetWeight: 0.065 },{ size: "18x23", gsm: "DUPLEX", perSheetWeight: 0.190 },{ size: "18x23", gsm: 120, perSheetWeight: 0.05 },{ size: "23x36", gsm: "STICKER", perSheetWeight: 0.08 },{ size: "23x36", gsm: "DUPLEX", perSheetWeight: 0.220 },{ size: "23x36", gsm: 90, perSheetWeight: 0.048 },{ size: "23x36", gsm: 100, perSheetWeight: 0.0532 },{ size: "20x30", gsm: 90, perSheetWeight: 0.0348 },{ size: "23x36", gsm: 120, perSheetWeight: 0.064 },{ size: "23x36", gsm: 125, perSheetWeight: 0.0668 },{ size: "23x36", gsm: 250, perSheetWeight: 0.1328 },{ size: "23x36", gsm: 300, perSheetWeight: 0.16 },{ size: "23x36", gsm: 350, perSheetWeight: 0.185 },{ size: "25x36", gsm: 125, perSheetWeight: 0.0726 },{ size: "25x36", gsm: 250, perSheetWeight: 0.1448 },{ size: "25x36", gsm: 300, perSheetWeight: 0.1736 },{ size: "25x36", gsm: 350, perSheetWeight: 0.200 },{ size: "25x38", gsm: 250, perSheetWeight: 0.1532 },{ size: "25x38", gsm: 300, perSheetWeight: 0.1839 },{ size: "23x36", gsm: 58, perSheetWeight: 0.0308 },{ size: "23x36", gsm: 70, perSheetWeight: 0.0372 },{ size: "23x36", gsm: 80, perSheetWeight: 0.0426 },{ size: "25x36", gsm: 80, perSheetWeight: 0.0462 },{ size: "25x36", gsm: 90, perSheetWeight: 0.052 },{ size: "25x36", gsm: 100, perSheetWeight: 0.0578 },{ size: "20X30", gsm: 250, perSheetWeight: 0.0968 },{ size: "20X30", gsm: 300, perSheetWeight: 0.116 },{ size: "19X25", gsm: 250, perSheetWeight: 0.0766 },{ size: "19X25", gsm: 300, perSheetWeight: 0.092 }
        ];

        // --- ELEMENT SELECTORS ---
        const allCostInputs = document.querySelectorAll('.cost-input');
        const totalCostDisplay = document.getElementById('total-cost');
        const jobSizeSelect = document.getElementById('job-size');
        const quantityInput = document.getElementById('quantity');
        const fbCheck = document.getElementById('fb-check');
        const withoutPlateCheck = document.getElementById('without-plate-check');
        const printingCostInput = document.getElementById('printing-cost');
        const secondCostInput = document.getElementById('second-cost');
        const printingGsmSelect = document.getElementById('printing-gsm-select');
        const paperGsmSelect = document.getElementById('paper-gsm-select');
        const paperSizeSelect = document.getElementById('paper-size-select');
        const paperSheetsInput = document.getElementById('paper-sheets-input');
        const paperRateInput = document.getElementById('paper-rate-input');
        const gstCheckbox = document.getElementById('gst-checkbox');
        const paperCostInput = document.getElementById('paper-cost');
        const downloadPdfBtn = document.getElementById('download-pdf-btn');

        // --- CALCULATION FUNCTIONS ---
        function calculateGrandTotal() {
            let total = 0;
            allCostInputs.forEach(input => { total += parseFloat(input.value) || 0; });
            const roundedTotal = Math.ceil(total / 50) * 50;
            totalCostDisplay.textContent = `₹ ${roundedTotal.toFixed(2)}`;
        }

        function calculatePrintingCosts() {
            const isWithoutPlate = withoutPlateCheck.checked;
            const selectedGsm = String(printingGsmSelect.value).toUpperCase();
            const selectedSize = jobSizeSelect.value;
            const heavyGsmList = ['300', '350', 'DUPLEX'];
            
            if (isWithoutPlate) {
                if (heavyGsmList.includes(selectedGsm)) { printingCostInput.value = (selectedSize === '12X18' || selectedSize === '10X15') ? 1000 : 1400; } 
                else { printingCostInput.value = (selectedSize === '12X18' || selectedSize === '10X15') ? 700 : 1000; }
            } else {
                if (heavyGsmList.includes(selectedGsm)) { printingCostInput.value = 2400; } 
                else { printingCostInput.value = (selectedSize === '12X18' || selectedSize === '10X15') ? 1200 : 1900; }
            }

            const baseQuantity = parseFloat(quantityInput.value) || 0;
            const isFbChecked = fbCheck.checked;
            const effectiveQuantity = isFbChecked ? baseQuantity * 2 : baseQuantity;
            let secondCost = 0;
            if (effectiveQuantity > 1000) {
                const ratePer1000 = (selectedSize === '12X18' || selectedSize === '10X15') ? 300 : 600;
                const exceedingQuantity = effectiveQuantity - 1000;
                const blocks = Math.ceil(exceedingQuantity / 1000);
                secondCost = blocks * ratePer1000;
            }
            secondCostInput.value = secondCost.toFixed(2);
            calculateGrandTotal();
        }

        function calculatePaperCost() {
            const selectedSize = paperSizeSelect.value;
            const selectedGsm = paperGsmSelect.value;
            const sheets = parseFloat(paperSheetsInput.value) || 0;
            const rate = parseFloat(paperRateInput.value) || 0;
            const withoutGst = gstCheckbox.checked;
            const paperInfo = paperData.find(d => d.size.toLowerCase() === selectedSize.toLowerCase() && String(d.gsm).toLowerCase() === selectedGsm.toLowerCase());
            const perSheetWeight = paperInfo ? paperInfo.perSheetWeight : 0;
            const basePrice = perSheetWeight * sheets * rate;
            const gstRate = withoutGst ? 0 : 0.12;
            const finalPrice = basePrice * (1 + gstRate);
            const roundedPaperCost = Math.ceil(finalPrice / 50) * 50;
            paperCostInput.value = roundedPaperCost.toFixed(2);
            calculateGrandTotal();
        }
        
        function calculateNumberOfSheets() {
            const jobSize = jobSizeSelect.value;
            const quantity = parseFloat(quantityInput.value) || 0;
            const paperGsm = String(paperGsmSelect.value).toUpperCase();
            const heavyGsmList = ['300', '350', 'DUPLEX'];
            let divisionFactor = 0;

            if (jobSize === '20X28' && heavyGsmList.includes(paperGsm)) { divisionFactor = 1; } 
            else if (jobSize === '12X18' || jobSize === '10X15') { divisionFactor = (paperGsm === 'STICKER') ? 2 : 4; } 
            else if (jobSize) { divisionFactor = (paperGsm === 'STICKER') ? 1 : 2; }

            const sheets = (divisionFactor > 0) ? Math.ceil(quantity / divisionFactor) : 0;
            paperSheetsInput.value = sheets;
            calculatePaperCost();
        }

        // --- UI & DATA POPULATION ---
        function populateStaticGsmDropdowns() {
            const allGsm = [...new Set(paperData.map(item => item.gsm))];
            allGsm.sort((a, b) => {
                const aIsString = isNaN(a); const bIsString = isNaN(b);
                if (aIsString && !bIsString) return -1; if (!aIsString && bIsString) return 1;
                if (aIsString && bIsString) return a.localeCompare(b);
                return a - b;
            });
            printingGsmSelect.innerHTML = '<option value="">Select GSM</option>';
            paperGsmSelect.innerHTML = '<option value="">Select GSM</option>';
            allGsm.forEach(gsm => {
                const option = `<option value="${gsm}">${gsm}</option>`;
                printingGsmSelect.innerHTML += option;
                paperGsmSelect.innerHTML += option;
            });
        }

        function populatePaperSizes() {
            const uniqueSizes = [...new Set(paperData.map(item => item.size.toUpperCase()))];
            paperSizeSelect.innerHTML = '<option value="">Select Size</option>';
            uniqueSizes.sort().forEach(size => { paperSizeSelect.innerHTML += `<option value="${size}">${size}</option>`; });
        }
        
        function syncGsm(source, target) {
            target.value = source.value;
            calculatePrintingCosts();
            calculateNumberOfSheets();
        }

        // --- PDF GENERATION ---
        function generatePDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            // --- Document Header ---
            doc.setFontSize(22);
            doc.setFont("helvetica", "bold");
            doc.text("Cost Estimate", 14, 22);

            doc.setFontSize(11);
            doc.setFont("helvetica", "normal");
            const estimateNr = Math.floor(1000 + Math.random() * 9000);
            const today = new Date().toLocaleDateString('en-GB');
            doc.text(`Cost estimate Nr.: ${estimateNr}`, 14, 35);
            doc.text(`Date: ${today}`, 150, 35);
            doc.text("Customer Nr.: CUST-001", 150, 28);
            
            // --- Body Text ---
            doc.text("Dear Customer,", 14, 50);
            doc.text("We thank you for your enquiry and would like to make the following offer:", 14, 57);

            // --- Table Data ---
            const tableBody = [];
            let subtotal = 0;
            let pos = 1;

            allCostInputs.forEach(input => {
                const cost = parseFloat(input.value) || 0;
                if (cost > 0) {
                    const designation = input.dataset.label || 'Cost Item';
                    tableBody.push([pos++, designation, 1, 'Item', `${cost.toFixed(2)} ₹`, `${cost.toFixed(2)} ₹`]);
                    subtotal += cost;
                }
            });

            // --- Table Creation ---
            doc.autoTable({
                head: [['Pos.', 'Designation', 'Quantity', 'Unit', 'Single price', 'Total price']],
                body: tableBody,
                startY: 65,
                theme: 'grid',
                headStyles: { fillColor: [22, 160, 133] }
            });

            // --- Totals ---
            let finalY = doc.lastAutoTable.finalY + 10;
            const vat = subtotal * 0.12; // 12% VAT/GST example
            const total = subtotal + vat;
            
            doc.setFontSize(12);
            doc.text(`Subtotal`, 140, finalY);
            doc.text(`${subtotal.toFixed(2)} ₹`, 190, finalY, { align: 'right' });
            
            doc.text(`12.00 % VAT`, 140, finalY + 7);
            doc.text(`${vat.toFixed(2)} ₹`, 190, finalY + 7, { align: 'right' });
            
            doc.setFont("helvetica", "bold");
            doc.text(`Total`, 140, finalY + 14);
            doc.text(`${total.toFixed(2)} ₹`, 190, finalY + 14, { align: 'right' });
            
            // --- Footer Text ---
            doc.setFontSize(11);
            doc.setFont("helvetica", "normal");
            doc.text("This offer is valid until " + new Date(Date.now() + 15 * 24 * 60 * 60 * 1000).toLocaleDateString('en-GB') + ".", 14, doc.internal.pageSize.height - 20);
            doc.text("We hope you will approve and look forward to working with you.", 14, doc.internal.pageSize.height - 13);
            
            // --- Save PDF ---
            doc.save(`Cost-Estimate-${estimateNr}.pdf`);
        }


        // --- EVENT LISTENERS ---
        allCostInputs.forEach(input => {
            input.addEventListener('input', calculateGrandTotal);
        });
        
        [jobSizeSelect, fbCheck, withoutPlateCheck].forEach(el => el.addEventListener('change', calculatePrintingCosts));
        quantityInput.addEventListener('input', () => { calculatePrintingCosts(); calculateNumberOfSheets(); });
        
        printingGsmSelect.addEventListener('change', () => syncGsm(printingGsmSelect, paperGsmSelect));
        paperGsmSelect.addEventListener('change', () => syncGsm(paperGsmSelect, printingGsmSelect));
        
        paperSizeSelect.addEventListener('change', calculateNumberOfSheets);
        [paperRateInput, gstCheckbox].forEach(el => el.addEventListener('change', calculatePaperCost));
        paperRateInput.addEventListener('input', calculatePaperCost);
        paperSheetsInput.addEventListener('input', calculatePaperCost);

        downloadPdfBtn.addEventListener('click', generatePDF);
        
        // --- INITIALIZATION ---
        populatePaperSizes();
        populateStaticGsmDropdowns();
        calculateNumberOfSheets();
        calculateGrandTotal();
    });
    </script>
</body>
</html>
