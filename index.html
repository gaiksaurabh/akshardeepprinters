<!DOCTYPE html>
<html>
<head>
    <title>Printing Estimate Tool</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        select, input, button { padding: 6px; margin: 5px; }
        .modal {
            display: none; position: fixed; z-index: 999; left: 0; top: 0;
            width: 100%; height: 100%; overflow: auto;
            background-color: rgba(0,0,0,0.5);
        }
        .modal-content {
            background: #fff; margin: 15% auto; padding: 20px;
            border-radius: 5px; width: 300px;
        }
        .modal-content button { display: block; margin: 5px 0; }
    </style>
</head>
<body>

<h2>Printing Estimate Tool</h2>

<label>Paper Size:</label>
<select id="paper-size-select"></select>

<label>Printing GSM:</label>
<select id="printing-gsm-select"></select>

<label>Paper GSM:</label>
<select id="paper-gsm-select"></select>

<br>
<button id="prev-estimates-btn">Past Estimates</button>

<!-- Past Estimates Modal -->
<div id="past-estimates-modal" class="modal">
    <div class="modal-content">
        <h3>Past Estimates</h3>
        <div id="past-estimates-list"></div>
        <button onclick="closePastEstimates()">Close</button>
    </div>
</div>

<script>
    // Sample paper data
    const paperData = [
        { size: "A4", gsm: 70, rate: 1.2 },
        { size: "A4", gsm: 80, rate: 1.4 },
        { size: "A4", gsm: 100, rate: 1.8 },
        { size: "A3", gsm: 80, rate: 2.5 },
        { size: "A3", gsm: 100, rate: 3.0 }
    ];

    const paperSizeSelect = document.getElementById("paper-size-select");
    const printingGsmSelect = document.getElementById("printing-gsm-select");
    const paperGsmSelect = document.getElementById("paper-gsm-select");

    // Populate Paper Size dropdown
    function populatePaperSizes() {
        const sizes = [...new Set(paperData.map(p => p.size))];
        paperSizeSelect.innerHTML = "";
        sizes.forEach(size => {
            const option = document.createElement("option");
            option.value = size;
            option.textContent = size;
            paperSizeSelect.appendChild(option);
        });
    }

    // Populate GSM dropdowns based on selected paper size
    function populateGsmOptions(size) {
        const gsmOptions = [...new Set(paperData.filter(p => p.size === size).map(p => p.gsm))];
        printingGsmSelect.innerHTML = "";
        paperGsmSelect.innerHTML = "";
        gsmOptions.forEach(gsm => {
            const opt1 = document.createElement("option");
            opt1.value = gsm;
            opt1.textContent = gsm;
            printingGsmSelect.appendChild(opt1);

            const opt2 = document.createElement("option");
            opt2.value = gsm;
            opt2.textContent = gsm;
            paperGsmSelect.appendChild(opt2);
        });
    }

    // Event listener to update GSM when paper size changes
    paperSizeSelect.addEventListener("change", () => {
        populateGsmOptions(paperSizeSelect.value);
    });

    // Populate on load
    populatePaperSizes();
    populateGsmOptions(paperSizeSelect.value);

    // --- Past Estimates Handling ---
    document.getElementById("prev-estimates-btn").addEventListener("click", () => {
        const modal = document.getElementById("past-estimates-modal");
        const list = document.getElementById("past-estimates-list");
        list.innerHTML = "";

        let savedEstimates = JSON.parse(localStorage.getItem("estimates")) || [];
        if (savedEstimates.length === 0) {
            list.innerHTML = "<p>No past estimates found.</p>";
        } else {
            savedEstimates.forEach((est, index) => {
                const btn = document.createElement("button");
                btn.textContent = `Estimate ${index + 1} - ${est.size}, ${est.gsm}gsm`;
                btn.addEventListener("click", () => loadEstimate(est));
                list.appendChild(btn);
            });
        }

        modal.style.display = "block";
    });

    function closePastEstimates() {
        document.getElementById("past-estimates-modal").style.display = "none";
    }

    // Example load function
    function loadEstimate(data) {
        paperSizeSelect.value = data.size;
        populateGsmOptions(data.size);
        printingGsmSelect.value = data.gsm;
        paperGsmSelect.value = data.gsm;
        closePastEstimates();
        alert("Estimate loaded!");
    }

    // Example save (you can trigger this wherever needed)
    function saveEstimate(size, gsm) {
        let estimates = JSON.parse(localStorage.getItem("estimates")) || [];
        estimates.push({ size, gsm });
        localStorage.setItem("estimates", JSON.stringify(estimates));
    }

    // Example pre-save some estimates for testing
    if (!localStorage.getItem("estimates")) {
        saveEstimate("A4", 80);
        saveEstimate("A3", 100);
    }
</script>

</body>
</html>
